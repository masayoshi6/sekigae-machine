<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>åº§å¸­è¡¨ - å¸­æ›¿ãˆã‚¢ãƒ—ãƒª</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
    }

    .container {
        display: flex;
        gap: 30px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .seating-area {
        background-color: #4ECDC4;
        padding: 20px;
        border-radius: 10px;
        flex: 1;
    }

    .seating-title {
        color: white;
        text-align: center;
        margin-bottom: 20px;
        font-size: 18px;
        font-weight: bold;
    }

    .seating-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
        max-width: 400px;
        margin: 0 auto;
    }

    .seat {
        width: 80;
        height: 80px;
        background-color: white;
        border: 2px solid #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .seat:hover {
        background-color: #f0f0f0;
        border-color: #333;
    }

    .seat.occupied {
        background-color: #ffb3ba;
        border-color: #ff6b7a;
    }

    .seat.male {
        background-color: #b3d9ff;
        border-color: #6bb6ff;
    }

    .seat.female {
        background-color: #ffb3e6;
        border-color: #ff6bcf;
    }

    .controls {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        flex: 1;
        height: fit-content;
    }

    .control-section {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
    }

    .control-title {
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
    }

    .button {
        background-color: #e91e63;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    .button:hover {
        background-color: #c2185b;
    }

    .button.save {
        background-color: #4caf50;
    }

    .button.save:hover {
        background-color: #45a049;
    }

    .button.restore {
        background-color: #2196f3;
    }

    .button.restore:hover {
        background-color: #1976d2;
    }

    .button.delete {
        background-color: #f44336;
    }

    .button.delete:hover {
        background-color: #d32f2f;
    }

    .nav-links {
        margin-bottom: 20px;
    }

    .nav-links a {
        color: #333;
        text-decoration: none;
        margin-right: 15px;
    }

    .nav-links a:hover {
        text-decoration: underline;
    }

    .blackboard {
        background-color: #2d5a2d;
        color: white;
        text-align: center;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
        font-weight: bold;
    }

    .shuffle-form {
        display: inline;
    }

    .constraint-options {
        margin-bottom: 15px;
    }

    .constraint-options label {
        display: block;
        margin-bottom: 8px;
        cursor: pointer;
    }

    .constraint-options input[type="checkbox"] {
        margin-right: 8px;
    }

    .snapshot-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 10px;
    }

    .snapshot-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        border-bottom: 1px solid #f0f0f0;
        margin-bottom: 5px;
    }

    .snapshot-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .snapshot-info {
        flex: 1;
    }

    .snapshot-name {
        font-weight: bold;
        font-size: 14px;
    }

    .snapshot-date {
        font-size: 12px;
        color: #666;
    }

    .snapshot-actions {
        display: flex;
        gap: 5px;
    }

    .small-button {
        padding: 4px 8px;
        font-size: 12px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
    }

    .message {
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
    }

    .success-message {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
    }

    .error-message {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
    }

    .save-form {
        margin-bottom: 10px;
    }

    .save-form input[type="text"] {
        padding: 5px;
        margin: 5px;
        border: 1px solid #ddd;
        border-radius: 3px;
        width: 200px;
    }

    .save-form textarea {
        padding: 5px;
        margin: 5px;
        border: 1px solid #ddd;
        border-radius: 3px;
        width: 200px;
        height: 40px;
        resize: vertical;
    }
  </style>
</head>
<body>

<div class="nav-links">
  <a th:href="@{/students}">ğŸ“‹ ç”Ÿå¾’ä¸€è¦§</a>
  <a th:href="@{/students/new}">â• ç”Ÿå¾’è¿½åŠ </a>
  <a th:href="@{/}">ğŸ  ãƒ›ãƒ¼ãƒ </a>
</div>

<h1>ğŸª‘ å¸­æ›¿ãˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h1>

<!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
<div th:if="${successMessage}" class="message success-message" th:text="${successMessage}"></div>
<div th:if="${errorMessage}" class="message error-message" th:text="${errorMessage}"></div>

<div class="container">
  <!-- åº§å¸­è¡¨ã‚¨ãƒªã‚¢ -->
  <div class="seating-area">
    <div class="seating-title">ä»Šã®åº§å¸­ â„¹ï¸</div>

    <!-- é»’æ¿ -->
    <div class="blackboard">
      é»’æ¿
    </div>

    <!-- åº§å¸­ã‚°ãƒªãƒƒãƒ‰ -->
    <div class="seating-grid">
      <th:block th:each="row, rowStat : ${seatingChart}">
        <th:block th:each="seat, colStat : ${row}">
          <div class="seat"
               th:classappend="${seat != null} ? (${seat.gender} == 'ç”·å­' ? ' male' : ' female') : ''"
               th:data-row="${rowStat.index + 1}"
               th:data-col="${colStat.index + 1}">
            <span th:text="${seat != null} ? ${seat.name} : ''"></span>
          </div>
        </th:block>
      </th:block>
    </div>
  </div>

  <!-- åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
  <div class="controls">
    <div class="control-section">
      <div class="control-title">ğŸ¯ æ¡ä»¶</div>
      <p>å¸­æ›¿ãˆã®æ¡ä»¶ã‚’è¨­å®šã§ãã¾ã™</p>
      <!-- TODO: æ¡ä»¶è¨­å®šUI -->
    </div>

    <!-- å¸­æ›¿ãˆãƒ•ã‚©ãƒ¼ãƒ  -->
    <form class="shuffle-form" method="post" action="/seating/shuffle">
      <input type="hidden" name="rows" th:value="${rows != null ? rows : 6}">
      <input type="hidden" name="columns" th:value="${columns != null ? columns : 5}">

      <div class="control-section">
        <div class="control-title">ğŸ”„ åˆ¶ç´„ã§åˆ¶é™ã™ã‚‹</div>
        <div class="constraint-options">
          <label>
            <input type="checkbox" name="preventSameGender" id="preventSameGender">
            ç”·å¥³ã®åº§å¸­ã‚’äº¤äº’ã«ã™ã‚‹ï¼ˆãƒã‚§ã‚¹ãƒœãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
          </label>
          <label>
            <input type="checkbox" name="alternateColumns" id="alternateColumns">
            åˆ—å˜ä½ã§ç”·å¥³ã‚’åˆ†ã‘ã‚‹ï¼ˆ1åˆ—ç›®ï¼šç”·å­ã€2åˆ—ç›®ï¼šå¥³å­...ï¼‰
          </label>
        </div>
      </div>

      <div class="control-section">
        <div class="control-title">ğŸ² äº¤æ›å¯¾è±¡ã‚’çµã£ã¦</div>
        <div class="constraint-options">
          <label>
            <input type="checkbox" name="specificStudents" id="specificStudents">
            äº¤æ›å¯¾è±¡ç”Ÿå¾’ã‚’é¸ã¶
          </label>
        </div>
      </div>

      <div class="control-section">
        <button type="submit" class="button">ğŸ”„ åº§æ›¿ãˆ</button>
      </div>
    </form>

    <!-- åº§å¸­ä¿å­˜ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="control-section">
      <div class="control-title">ğŸ’¾ åº§å¸­é…ç½®ã‚’ä¿å­˜</div>
      <form class="save-form" method="post" action="/seating/save">
        <input type="hidden" name="rows" th:value="${rows != null ? rows : 6}">
        <input type="hidden" name="columns" th:value="${columns != null ? columns : 5}">

        <div>
          <input type="text" name="snapshotName" placeholder="ä¿å­˜åï¼ˆçœç•¥å¯ï¼‰" maxlength="100">
        </div>
        <div>
          <textarea name="description" placeholder="èª¬æ˜ï¼ˆçœç•¥å¯ï¼‰" maxlength="255"></textarea>
        </div>
        <button type="submit" class="button save">ğŸ’¾ ç¾åœ¨ã®åº§å¸­ã‚’ä¿å­˜</button>
      </form>
    </div>

    <!-- ä¿å­˜ã•ã‚ŒãŸåº§å¸­é…ç½®ä¸€è¦§ -->
    <div class="control-section" th:if="${snapshots != null and !snapshots.isEmpty()}">
      <div class="control-title">ğŸ“ ä¿å­˜ã•ã‚ŒãŸåº§å¸­é…ç½®</div>
      <div class="snapshot-list">
        <div class="snapshot-item" th:each="snapshot : ${snapshots}">
          <div class="snapshot-info">
            <div class="snapshot-name" th:text="${snapshot.snapshotName}">åº§å¸­é…ç½®å</div>
            <div class="snapshot-date"
                 th:text="${#temporals.format(snapshot.createdAt, 'yyyy-MM-dd HH:mm')}">
              2024-01-01 12:00
            </div>
            <div class="snapshot-date"
                 th:if="${snapshot.description != null and !snapshot.description.isEmpty()}"
                 th:text="'èª¬æ˜: ' + ${snapshot.description}">
              èª¬æ˜æ–‡
            </div>
          </div>
          <div class="snapshot-actions">
            <!-- å¾©å…ƒãƒœã‚¿ãƒ³ -->
            <form method="post" action="/seating/restore" style="display: inline;">
              <input type="hidden" name="snapshotId" th:value="${snapshot.id}">
              <button type="submit" class="small-button restore"
                      onclick="return confirm('ã“ã®åº§å¸­é…ç½®ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®é…ç½®ã¯å¤±ã‚ã‚Œã¾ã™ã€‚')">
                å¾©å…ƒ
              </button>
            </form>
            <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
            <form method="post" action="/seating/delete-snapshot" style="display: inline;">
              <input type="hidden" name="snapshotId" th:value="${snapshot.id}">
              <button type="submit" class="small-button delete"
                      onclick="return confirm('ã“ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                å‰Šé™¤
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="control-section" th:if="${snapshots == null or snapshots.isEmpty()}">
      <div class="control-title">ğŸ“ ä¿å­˜ã•ã‚ŒãŸåº§å¸­é…ç½®</div>
      <p style="color: #666; font-style: italic;">ä¿å­˜ã•ã‚ŒãŸåº§å¸­é…ç½®ã¯ã‚ã‚Šã¾ã›ã‚“</p>
    </div>
  </div>
</div>

<script>
  // åº§å¸­ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
  document.querySelectorAll('.seat').forEach(seat => {
      seat.addEventListener('click', function() {
          const row = this.dataset.row;
          const col = this.dataset.col;
          const studentName = this.textContent.trim();

          if (studentName) {
              alert(`åº§å¸­ ${row}è¡Œ${col}åˆ—: ${studentName}`);
          } else {
              alert(`åº§å¸­ ${row}è¡Œ${col}åˆ—: ç©ºå¸­`);
          }
      });
  });

  // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®æ’ä»–åˆ¶å¾¡
  document.addEventListener('DOMContentLoaded', function() {
      const preventSameGender = document.getElementById('preventSameGender');
      const alternateColumns = document.getElementById('alternateColumns');

      // ãƒã‚§ã‚¹ãƒœãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‰åˆ—å˜ä½ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™
      preventSameGender.addEventListener('change', function() {
          if (this.checked) {
              alternateColumns.checked = false;
          }
      });

      // åˆ—å˜ä½ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ãƒã‚§ã‚¹ãƒœãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™
      alternateColumns.addEventListener('change', function() {
          if (this.checked) {
              preventSameGender.checked = false;
          }
      });

      // æˆåŠŸãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•ã§æ¶ˆã™
      const messages = document.querySelectorAll('.message');
      messages.forEach(message => {
          setTimeout(() => {
              message.style.opacity = '0';
              setTimeout(() => {
                  message.remove();
              }, 300);
          }, 5000); // 5ç§’å¾Œã«æ¶ˆãˆã‚‹
      });
  });
</script>

</body>
</html>